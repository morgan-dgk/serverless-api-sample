<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: handlers/presigned-post.mjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: handlers/presigned-post.mjs</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  PutObjectCommand,
} from "@aws-sdk/client-s3";
import { getSignedUrl } from "@aws-sdk/s3-request-presigner";
import { getScopedS3Client } from "/opt/nodejs/helpers.mjs";

// Duration presigned url is valid for.
const TTL = 300

/**
Handler for client file upload. 

The client's bucket name and temporary credentials for access to the bucket are provided by the auth response from
the lambda authorizer and are accessible on `requestContext.authorizer.lambda.credentials`. The file name
should be passed as a path parameter, e.g. files/{url-encoded-file-name-here}.
*/

export const LambdaHandler = async (event) => {
  const credentials = event.requestContext.authorizer.lambda.credentials;
  const bucket = event.requestContext.authorizer.lambda.bucket;
  const key = event.pathParameters.file_name;

  const client = getScopedS3Client(credentials);

  const putObjCommand = new PutObjectCommand({Bucket: bucket, Key: key});
  return await getSignedUrl(client, putObjCommand, {expiresIn: TTL});
  
}


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#LambdaHandler">LambdaHandler</a></li><li><a href="global.html#assumeUserRole">assumeUserRole</a></li><li><a href="global.html#authorize">authorize</a></li><li><a href="global.html#getClaims">getClaims</a></li><li><a href="global.html#getPolicyForTenantUser">getPolicyForTenantUser</a></li><li><a href="global.html#getScopedS3Client">getScopedS3Client</a></li><li><a href="global.html#parseTokenData">parseTokenData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Tue May 07 2024 13:10:16 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
